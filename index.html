<!DOCTYPE html>
<html>
   <head>
      <title>Octopussy: Which GitHubbers are following you?</title>
      <script src="https://ajax.googleapis.com/ajax/libs/mootools/1.3.2/mootools-yui-compressed.js" type="text/javascript"></script>
      <script src="github.js" type="text/javascript"></script>
      <style>
         #data {
            display: none;
            margin: 20px;
         }
      </style>
   </head>
   <body>
      <h1>Octopussy</h1>
      <p>So I was dicking around with <a href="http://coderwall.com/icco" title="icco on CodeWall">CodeWall</a>, and I got the Octopussy badge. This was really awesome, but I had no idea who from GitHub was following my projects. So I decided to write me some JavaScript to figure it out.</p>

      <form id="form" method="post">
         <input type="text" id="username" name="username"></input>
         <input type="submit"></input>
      </form>

      <div id="data">
         It looks like you have <span id="repocount">0</span> repos.

         <ul id="repos">
         </ul>
      </div>

      <script type="text/javascript">
         $('form').addEvent('submit', function(ev) {
            ev.preventDefault();
            $('repocount').set('text', "0")
            $('repos').set('html', "")
            $('data').setStyle('display', 'block');

            var user = gh.user($("username").get("value"));
            console.log(user);

            user.repos(function (data) {
                $('repocount').set('text', data.repositories.length);

                data.repositories.each(function(repo) {
                   r = gh.repo("icco", repo.name);
                   var li = new Element('li');
                   if (repo.watchers > 1) {
                      r.show(function (data) {
                         console.log(data.repository.followers);
                      });

                      li.set('text', repo.name + ": " + repo.watchers + " watchers.");
                      $('repos').adopt(li);
                   }
                });
            });
         });
      </script>
   </body>
</html>
